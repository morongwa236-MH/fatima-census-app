<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Lady of Fatima Shrine Census Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .form-section {
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .card {
            background-color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        .bg-gradient-blue {
            background: linear-gradient(135deg, #1d4ed8, #3b82f6);
        }
        .bg-gradient-green {
            background: linear-gradient(135deg, #059669, #10b981);
        }
        .message-box {
            transition: opacity 0.3s ease-in-out;
        }
        .hidden {
            display: none;
        }
        .btn-primary {
            @apply bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center p-4">

    <!-- Navigation Bar -->
    <nav class="w-full max-w-4xl p-4 mb-8 bg-white rounded-xl shadow-md flex justify-between items-center">
        <h1 class="text-xl font-bold text-gray-800">Census App</h1>
        <div class="space-x-4">
            <a href="index.html" class="text-blue-600 font-semibold hover:text-blue-800">Census Form</a>
            <a href="admin.html" class="text-gray-600 hover:text-blue-800">Admin Dashboard</a>
        </div>
    </nav>
    
    <div class="max-w-4xl w-full mx-auto p-4">
        <h1 class="text-3xl md:text-4xl font-extrabold text-center text-gray-900 mb-2">Our Lady of Fatima Shrine</h1>
        <h2 class="text-xl md:text-2xl font-semibold text-center text-gray-700 mb-8">Census Form</h2>

        <div id="messageBox" class="message-box hidden opacity-0 transition-opacity"></div>

        <form id="censusForm" class="space-y-6">
            <!-- Household Section -->
            <div class="card p-6 md:p-8">
                <h3 class="text-2xl font-bold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-home mr-3 text-blue-600"></i>Household Details
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="HouseholdID" class="block text-gray-700 font-medium mb-1">Household ID</label>
                        <input type="text" id="HouseholdID" name="HouseholdID" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Block A - 101" required>
                    </div>
                    <div>
                        <label for="BlockName" class="block text-gray-700 font-medium mb-1">Block Name</label>
                        <input type="text" id="BlockName" name="BlockName" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Block A" required>
                    </div>
                    <div class="md:col-span-2">
                        <label for="Address" class="block text-gray-700 font-medium mb-1">Address</label>
                        <textarea id="Address" name="Address" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Enter your full address" required></textarea>
                    </div>
                </div>
            </div>

            <!-- Members Section -->
            <div class="card p-6 md:p-8">
                <h3 class="text-2xl font-bold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-users mr-3 text-blue-600"></i>Family Members
                </h3>
                <div id="membersContainer" class="space-y-4"></div>
                <button type="button" id="addMemberBtn" class="mt-4 w-full py-2 px-4 rounded-lg bg-green-500 text-white font-semibold hover:bg-green-600 transition-colors duration-300">
                    Add another Family Member
                </button>
            </div>

            <!-- Children Section -->
            <div class="card p-6 md:p-8">
                <h3 class="text-2xl font-bold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-child mr-3 text-blue-600"></i>Children (under 18)
                </h3>
                <div id="childrenContainer" class="space-y-4"></div>
                <button type="button" id="addChildBtn" class="mt-4 w-full py-2 px-4 rounded-lg bg-green-500 text-white font-semibold hover:bg-green-600 transition-colors duration-300">
                    Add another Child
                </button>
            </div>

            <!-- Submit Button -->
            <div class="text-center">
                <button type="submit" class="w-full md:w-auto btn-primary">
                    <i class="fas fa-check-circle mr-2"></i>Submit Form
                </button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_URL = "https://script.google.com/macros/s/AKfycbzDmCUNZYLbjqTAg-IMkyZHaX9B1RXrkT_0YBig9vF984c1mdmhzWPaYhxVO__qBnYXcQ/exec"; // Replace with your Google Apps Script URL
            const censusForm = document.getElementById('censusForm');
            const membersContainer = document.getElementById('membersContainer');
            const childrenContainer = document.getElementById('childrenContainer');
            const addMemberBtn = document.getElementById('addMemberBtn');
            const addChildBtn = document.getElementById('addChildBtn');
            const messageBox = document.getElementById('messageBox');

            let memberCount = 0;
            let childCount = 0;

            const removeParent = (event) => {
                event.target.closest('.card').remove();
            };

            const addMemberForm = () => {
                memberCount++;
                const memberCard = document.createElement('div');
                memberCard.className = 'card';
                memberCard.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-xl font-semibold text-gray-700">Family Member ${memberCount}</h4>
                        ${memberCount > 1 ? '<button type="button" class="text-red-500 hover:text-red-700 remove-btn"><i class="fas fa-times-circle"></i></button>' : ''}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">First Name</label>
                            <input type="text" name="memberFirstName" class="w-full p-2 border border-gray-300 rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Last Name</label>
                            <input type="text" name="memberLastName" class="w-full p-2 border border-gray-300 rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Date of Birth</label>
                            <input type="date" name="memberDateOfBirth" class="w-full p-2 border border-gray-300 rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Relationship to Head</label>
                            <input type="text" name="memberRelationship" class="w-full p-2 border border-gray-300 rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Catholic</label>
                            <select name="memberCatholic" class="w-full p-2 border border-gray-300 rounded-lg" required>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 font-medium mb-1">Church Activities/Organizations</label>
                            <input type="text" name="memberChurchActivities" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                `;
                membersContainer.appendChild(memberCard);
                if (memberCard.querySelector('.remove-btn')) {
                    memberCard.querySelector('.remove-btn').addEventListener('click', removeParent);
                }
            };

            const addChildForm = () => {
                childCount++;
                const childCard = document.createElement('div');
                childCard.className = 'card';
                childCard.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-xl font-semibold text-gray-700">Child ${childCount}</h4>
                        <button type="button" class="text-red-500 hover:text-red-700 remove-btn"><i class="fas fa-times-circle"></i></button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">First Name</label>
                            <input type="text" name="childFirstName" class="w-full p-2 border border-gray-300 rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Last Name</label>
                            <input type="text" name="childLastName" class="w-full p-2 border border-gray-300 rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Date of Birth</label>
                            <input type="date" name="childDateOfBirth" class="w-full p-2 border border-gray-300 rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Catholic</label>
                            <select name="childCatholic" class="w-full p-2 border border-gray-300 rounded-lg" required>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Church Activities</label>
                            <input type="text" name="childChurchActivities" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Baptised</label>
                            <select name="childBaptised" class="w-full p-2 border border-gray-300 rounded-lg">
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Baptism Date</label>
                            <input type="date" name="childBaptismDate" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Church of Baptism</label>
                            <input type="text" name="childChurchOfBaptism" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">First Communion</label>
                            <select name="childFirstCommunion" class="w-full p-2 border border-gray-300 rounded-lg">
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">First Communion Date</label>
                            <input type="date" name="childFirstCommunionDate" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Church of First Communion</label>
                            <input type="text" name="childChurchOfFirstCommunion" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Confirmation</label>
                            <select name="childConfirmation" class="w-full p-2 border border-gray-300 rounded-lg">
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Confirmation Date</label>
                            <input type="date" name="childConfirmationDate" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-1">Church of Confirmation</label>
                            <input type="text" name="childChurchOfConfirmation" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                `;
                childrenContainer.appendChild(childCard);
                childCard.querySelector('.remove-btn').addEventListener('click', removeParent);
            };

            addMemberBtn.addEventListener('click', addMemberForm);
            addChildBtn.addEventListener('click', addChildForm);

            // Initial forms
            addMemberForm();
            addChildForm();

            // Handle form submission
            censusForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData(censusForm);
                const household = {
                    HouseholdID: formData.get('HouseholdID'),
                    BlockName: formData.get('BlockName'),
                    Address: formData.get('Address'),
                };

                const members = [];
                document.querySelectorAll('#membersContainer .card').forEach((card, index) => {
                    const memberData = {
                        firstName: card.querySelector('[name="memberFirstName"]').value,
                        lastName: card.querySelector('[name="memberLastName"]').value,
                        dateOfBirth: card.querySelector('[name="memberDateOfBirth"]').value,
                        relationship: card.querySelector('[name="memberRelationship"]').value,
                        catholic: card.querySelector('[name="memberCatholic"]').value,
                        churchActivities: card.querySelector('[name="memberChurchActivities"]').value,
                    };
                    members.push(memberData);
                });

                const children = [];
                document.querySelectorAll('#childrenContainer .card').forEach((card, index) => {
                    const childData = {
                        firstName: card.querySelector('[name="childFirstName"]').value,
                        lastName: card.querySelector('[name="childLastName"]').value,
                        dateOfBirth: card.querySelector('[name="childDateOfBirth"]').value,
                        catholic: card.querySelector('[name="childCatholic"]').value,
                        churchActivities: card.querySelector('[name="childChurchActivities"]').value,
                        baptised: card.querySelector('[name="childBaptised"]').value,
                        baptismDate: card.querySelector('[name="childBaptismDate"]').value,
                        churchOfBaptism: card.querySelector('[name="childChurchOfBaptism"]').value,
                        firstCommunion: card.querySelector('[name="childFirstCommunion"]').value,
                        firstCommunionDate: card.querySelector('[name="childFirstCommunionDate"]').value,
                        churchOfFirstCommunion: card.querySelector('[name="childChurchOfFirstCommunion"]').value,
                        confirmation: card.querySelector('[name="childConfirmation"]').value,
                        confirmationDate: card.querySelector('[name="childConfirmationDate"]').value,
                        churchOfConfirmation: card.querySelector('[name="childChurchOfConfirmation"]').value,
                    };
                    children.push(childData);
                });

                const payload = {
                    action: 'submitForm',
                    household,
                    members,
                    children,
                };

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify(payload),
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                    showMessage('Form submitted successfully! Thank you.', 'bg-green-200 text-green-800');
                    censusForm.reset();
                    membersContainer.innerHTML = '';
                    childrenContainer.innerHTML = '';
                    memberCount = 0;
                    childCount = 0;
                    addMemberForm();
                    addChildForm();
                } catch (error) {
                    showMessage('An error occurred. Please try again.', 'bg-red-200 text-red-800');
                    console.error('Error submitting form:', error);
                }
            });

            function showMessage(message, colorClass) {
                messageBox.textContent = message;
                messageBox.className = `mt-4 p-4 rounded-lg text-sm text-center font-semibold ${colorClass} visible`;
                messageBox.classList.remove('hidden');
                messageBox.style.opacity = '1';
                setTimeout(() => {
                    messageBox.style.opacity = '0';
                    setTimeout(() => messageBox.classList.add('hidden'), 300);
                }, 5000);
            }
        });
    </script>
</body>
</html>

