<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Lady of Fatima Shrine Census Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .form-section {
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .card {
            background-color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        .bg-gradient-blue {
            background: linear-gradient(135deg, #1d4ed8, #3b82f6);
        }
        .bg-gradient-green {
            background: linear-gradient(135deg, #059669, #10b981);
        }
        .bg-gradient-yellow {
            background: linear-gradient(135deg, #ca8a04, #eab308);
        }
        .input-field {
            @apply w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500;
        }
        .btn {
            @apply px-4 py-2 rounded-xl font-semibold transition-colors duration-200;
        }
        .btn-blue {
            @apply bg-blue-600 text-white hover:bg-blue-700;
        }
        .message-box {
            @apply mt-4 p-4 rounded-lg text-sm text-center font-semibold transition-opacity duration-300 opacity-0;
        }
        .message-box.visible {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <!-- Main Form Container -->
    <div class="container mx-auto p-4 md:p-8">
        <div class="card p-8 shadow-xl">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Our Lady of Fatima Shrine Census Form</h1>
            
            <form id="censusForm" class="space-y-6">

                <!-- Household Section -->
                <div class="form-section bg-gradient-blue text-white">
                    <h2 class="text-2xl font-semibold mb-4">Household Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="blockName" class="block text-sm font-medium mb-1">Block Name</label>
                            <input type="text" id="blockName" name="blockName" placeholder="e.g., St Monica Block" required class="input-field text-black">
                        </div>
                        <div>
                            <label for="residentialAddress" class="block text-sm font-medium mb-1">Residential Address</label>
                            <input type="text" id="residentialAddress" name="residentialAddress" placeholder="e.g., 15 SMME Village" required class="input-field text-black">
                        </div>
                        <div class="md:col-span-2">
                            <label for="contactInformation" class="block text-sm font-medium mb-1">Contact Information (Phone, Email, etc.)</label>
                            <input type="text" id="contactInformation" name="contactInformation" placeholder="e.g., 071 234 5678" required class="input-field text-black">
                        </div>
                    </div>
                </div>

                <!-- Members Section -->
                <div class="form-section bg-gray-200 text-gray-800">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-semibold">Adult Members (18+)</h2>
                        <button type="button" id="addMemberBtn" class="btn btn-blue text-sm">
                            <i class="fas fa-plus mr-2"></i>Add Member
                        </button>
                    </div>
                    <div id="membersContainer" class="space-y-6">
                        <!-- Member forms will be dynamically added here -->
                    </div>
                </div>

                <!-- Children Section -->
                <div class="form-section bg-gray-200 text-gray-800">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-semibold">Children (Under 18)</h2>
                        <button type="button" id="addChildBtn" class="btn btn-blue text-sm">
                            <i class="fas fa-plus mr-2"></i>Add Child
                        </button>
                    </div>
                    <div id="childrenContainer" class="space-y-6">
                        <!-- Children forms will be dynamically added here -->
                    </div>
                </div>
                
                <div class="flex justify-center mt-6">
                    <button type="submit" class="btn btn-green w-full md:w-auto px-10 py-3 text-lg">
                        <i class="fas fa-paper-plane mr-2"></i>Submit
                    </button>
                </div>
                
                <div id="messageBox" class="message-box hidden"></div>
            </form>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_URL = "https://script.google.com/macros/s/AKfycbx5aYRqiurCgQ79xXz9KkzakXtK6DvQveyq9R2022xWrLo88uC5BDa-nsjyC_in73-sfw/exec"; 

            const censusForm = document.getElementById('censusForm');
            const membersContainer = document.getElementById('membersContainer');
            const childrenContainer = document.getElementById('childrenContainer');
            const addMemberBtn = document.getElementById('addMemberBtn');
            const addChildBtn = document.getElementById('addChildBtn');
            const messageBox = document.getElementById('messageBox');

            let memberCount = 0;
            let childCount = 0;

            // Add initial empty forms
            addMemberForm();
            addChildForm();

            addMemberBtn.addEventListener('click', addMemberForm);
            addChildBtn.addEventListener('click', addChildForm);

            function addMemberForm() {
                memberCount++;
                const memberCard = document.createElement('div');
                memberCard.className = 'card bg-gradient-green text-white relative';
                memberCard.innerHTML = `
                    <h3 class="text-xl font-semibold mb-4">Member ${memberCount}</h3>
                    <button type="button" class="remove-btn absolute top-4 right-4 text-white hover:text-red-300 text-lg">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" name="member-FirstName-${memberCount}" placeholder="First Name" class="input-field text-black" required>
                        <input type="text" name="member-LastName-${memberCount}" placeholder="Last Name" class="input-field text-black" required>
                        <input type="date" name="member-DateOfBirth-${memberCount}" placeholder="Date of Birth" class="input-field text-black">
                        <select name="member-Catholic-${memberCount}" class="input-field text-black">
                            <option value="Yes">Catholic</option>
                            <option value="No">Non-Catholic</option>
                        </select>
                        <input type="text" name="member-Occupation-${memberCount}" placeholder="Occupation" class="input-field text-black">
                        <input type="text" name="member-ChurchActivities-${memberCount}" placeholder="Church Activities" class="input-field text-black">
                        <input type="text" name="member-SolidarityMinistry-${memberCount}" placeholder="Solidarity Ministry" class="input-field text-black">
                        <input type="text" name="member-Leadership-${memberCount}" placeholder="Leadership Position" class="input-field text-black">
                        <select name="member-Baptised-${memberCount}" class="input-field text-black">
                            <option value="">Baptised?</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <input type="date" name="member-BaptismDate-${memberCount}" placeholder="Baptism Date" class="input-field text-black">
                        <input type="text" name="member-BaptismRegistrationNo-${memberCount}" placeholder="Baptism Reg. No." class="input-field text-black">
                        <input type="text" name="member-ChurchOfBaptism-${memberCount}" placeholder="Church of Baptism" class="input-field text-black">
                        <input type="text" name="member-LocationOfChurch-${memberCount}" placeholder="Location of Church" class="input-field text-black">
                        <select name="member-FirstCommunion-${memberCount}" class="input-field text-black">
                            <option value="">First Communion?</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <input type="date" name="member-FirstCommunionDate-${memberCount}" placeholder="First Communion Date" class="input-field text-black">
                        <input type="text" name="member-ChurchOfFirstCommunion-${memberCount}" placeholder="Church of First Communion" class="input-field text-black">
                        <select name="member-Confirmation-${memberCount}" class="input-field text-black">
                            <option value="">Confirmation?</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <input type="date" name="member-ConfirmationDate-${memberCount}" placeholder="Confirmation Date" class="input-field text-black">
                        <input type="text" name="member-ChurchOfConfirmation-${memberCount}" placeholder="Church of Confirmation" class="input-field text-black">
                        <select name="member-MaritalStatus-${memberCount}" class="input-field text-black">
                            <option value="">Marital Status</option>
                            <option value="Single">Single</option>
                            <option value="Married">Married</option>
                            <option value="Divorced">Divorced</option>
                            <option value="Widowed">Widowed</option>
                        </select>
                        <input type="date" name="member-CivilCourtMarriageDate-${memberCount}" placeholder="Civil Court Marriage Date" class="input-field text-black">
                        <input type="date" name="member-ChurchMarriageDate-${memberCount}" placeholder="Church Marriage Date" class="input-field text-black">
                        <input type="text" name="member-ChurchMarriagePlace-${memberCount}" placeholder="Church Marriage Place" class="input-field text-black">
                        <select name="member-Divorced-${memberCount}" class="input-field text-black">
                            <option value="">Divorced?</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <select name="member-Dikabelo-${memberCount}" class="input-field text-black">
                            <option value="">Dikabelo?</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <input type="date" name="member-DateOfLastDikabelo-${memberCount}" placeholder="Date of Last Dikabelo" class="input-field text-black">
                    </div>
                `;
                membersContainer.appendChild(memberCard);
                memberCard.querySelector('.remove-btn').addEventListener('click', () => memberCard.remove());
            }

            function addChildForm() {
                childCount++;
                const childCard = document.createElement('div');
                childCard.className = 'card bg-gradient-yellow text-white relative';
                childCard.innerHTML = `
                    <h3 class="text-xl font-semibold mb-4">Child ${childCount}</h3>
                    <button type="button" class="remove-btn absolute top-4 right-4 text-white hover:text-red-300 text-lg">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" name="child-FirstName-${childCount}" placeholder="First Name" class="input-field text-black" required>
                        <input type="text" name="child-LastName-${childCount}" placeholder="Last Name" class="input-field text-black" required>
                        <input type="date" name="child-DateOfBirth-${childCount}" placeholder="Date of Birth" class="input-field text-black">
                        <input type="text" name="child-Age-${childCount}" placeholder="Age" class="input-field text-black">
                        <select name="child-Catholic-${childCount}" class="input-field text-black">
                            <option value="Yes">Catholic</option>
                            <option value="No">Non-Catholic</option>
                        </select>
                        <input type="text" name="child-ChurchActivities-${childCount}" placeholder="Church Activities" class="input-field text-black">
                        <select name="child-Baptised-${childCount}" class="input-field text-black">
                            <option value="">Baptised?</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <input type="date" name="child-BaptismDate-${childCount}" placeholder="Baptism Date" class="input-field text-black">
                        <input type="text" name="child-BaptismRegistrationNo-${childCount}" placeholder="Baptism Reg. No." class="input-field text-black">
                        <input type="text" name="child-ChurchOfBaptism-${childCount}" placeholder="Church of Baptism" class="input-field text-black">
                        <input type="text" name="child-LocationOfChurch-${childCount}" placeholder="Location of Church" class="input-field text-black">
                        <select name="child-FirstCommunion-${childCount}" class="input-field text-black">
                            <option value="">First Communion?</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <input type="date" name="child-FirstCommunionDate-${childCount}" placeholder="First Communion Date" class="input-field text-black">
                        <input type="text" name="child-ChurchOfFirstCommunion-${childCount}" placeholder="Church of First Communion" class="input-field text-black">
                        <select name="child-Confirmation-${childCount}" class="input-field text-black">
                            <option value="">Confirmation?</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                        <input type="date" name="child-ConfirmationDate-${childCount}" placeholder="Confirmation Date" class="input-field text-black">
                        <input type="text" name="child-ChurchOfConfirmation-${childCount}" placeholder="Church of Confirmation" class="input-field text-black">
                    </div>
                `;
                childrenContainer.appendChild(childCard);
                childCard.querySelector('.remove-btn').addEventListener('click', () => childCard.remove());
            }

            censusForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const household = {
                    BlockName: document.getElementById('blockName').value,
                    ResidentialAddress: document.getElementById('residentialAddress').value,
                    ContactInformation: document.getElementById('contactInformation').value
                };
                
                const members = [];
                for (let i = 1; i <= memberCount; i++) {
                    const member = {};
                    const card = membersContainer.querySelector(`[name="member-FirstName-${i}"]`).closest('.card');
                    if (card) {
                        member.FirstName = card.querySelector(`[name="member-FirstName-${i}"]`).value;
                        member.LastName = card.querySelector(`[name="member-LastName-${i}"]`).value;
                        member.DateOfBirth = card.querySelector(`[name="member-DateOfBirth-${i}"]`).value;
                        member.Catholic = card.querySelector(`[name="member-Catholic-${i}"]`).value;
                        member.Occupation = card.querySelector(`[name="member-Occupation-${i}"]`).value;
                        member.ChurchActivities = card.querySelector(`[name="member-ChurchActivities-${i}"]`).value;
                        member.SolidarityMinistry = card.querySelector(`[name="member-SolidarityMinistry-${i}"]`).value;
                        member.Leadership = card.querySelector(`[name="member-Leadership-${i}"]`).value;
                        member.Baptised = card.querySelector(`[name="member-Baptised-${i}"]`).value;
                        member.BaptismDate = card.querySelector(`[name="member-BaptismDate-${i}"]`).value;
                        member.BaptismRegistrationNo = card.querySelector(`[name="member-BaptismRegistrationNo-${i}"]`).value;
                        member.ChurchOfBaptism = card.querySelector(`[name="member-ChurchOfBaptism-${i}"]`).value;
                        member.LocationOfChurch = card.querySelector(`[name="member-LocationOfChurch-${i}"]`).value;
                        member.FirstCommunion = card.querySelector(`[name="member-FirstCommunion-${i}"]`).value;
                        member.FirstCommunionDate = card.querySelector(`[name="member-FirstCommunionDate-${i}"]`).value;
                        member.ChurchOfFirstCommunion = card.querySelector(`[name="member-ChurchOfFirstCommunion-${i}"]`).value;
                        member.Confirmation = card.querySelector(`[name="member-Confirmation-${i}"]`).value;
                        member.ConfirmationDate = card.querySelector(`[name="member-ConfirmationDate-${i}"]`).value;
                        member.ChurchOfConfirmation = card.querySelector(`[name="member-ChurchOfConfirmation-${i}"]`).value;
                        member.MaritalStatus = card.querySelector(`[name="member-MaritalStatus-${i}"]`).value;
                        member.CivilCourtMarriageDate = card.querySelector(`[name="member-CivilCourtMarriageDate-${i}"]`).value;
                        member.ChurchMarriageDate = card.querySelector(`[name="member-ChurchMarriageDate-${i}"]`).value;
                        member.ChurchMarriagePlace = card.querySelector(`[name="member-ChurchMarriagePlace-${i}"]`).value;
                        member.Divorced = card.querySelector(`[name="member-Divorced-${i}"]`).value;
                        member.Dikabelo = card.querySelector(`[name="member-Dikabelo-${i}"]`).value;
                        member.DateOfLastDikabelo = card.querySelector(`[name="member-DateOfLastDikabelo-${i}"]`).value;
                        members.push(member);
                    }
                }

                const children = [];
                for (let i = 1; i <= childCount; i++) {
                    const child = {};
                    const card = childrenContainer.querySelector(`[name="child-FirstName-${i}"]`).closest('.card');
                    if (card) {
                        child.FirstName = card.querySelector(`[name="child-FirstName-${i}"]`).value;
                        child.LastName = card.querySelector(`[name="child-LastName-${i}"]`).value;
                        child.DateOfBirth = card.querySelector(`[name="child-DateOfBirth-${i}"]`).value;
                        child.Age = card.querySelector(`[name="child-Age-${i}"]`).value;
                        child.Catholic = card.querySelector(`[name="child-Catholic-${i}"]`).value;
                        child.ChurchActivities = card.querySelector(`[name="child-ChurchActivities-${i}"]`).value;
                        child.Baptised = card.querySelector(`[name="child-Baptised-${i}"]`).value;
                        child.BaptismDate = card.querySelector(`[name="child-BaptismDate-${i}"]`).value;
                        child.BaptismRegistrationNo = card.querySelector(`[name="child-BaptismRegistrationNo-${i}"]`).value;
                        child.ChurchOfBaptism = card.querySelector(`[name="child-ChurchOfBaptism-${i}"]`).value;
                        child.LocationOfChurch = card.querySelector(`[name="child-LocationOfChurch-${i}"]`).value;
                        child.FirstCommunion = card.querySelector(`[name="child-FirstCommunion-${i}"]`).value;
                        child.FirstCommunionDate = card.querySelector(`[name="child-FirstCommunionDate-${i}"]`).value;
                        child.ChurchOfFirstCommunion = card.querySelector(`[name="child-ChurchOfFirstCommunion-${i}"]`).value;
                        child.Confirmation = card.querySelector(`[name="child-Confirmation-${i}"]`).value;
                        child.ConfirmationDate = card.querySelector(`[name="child-ConfirmationDate-${i}"]`).value;
                        child.ChurchOfConfirmation = card.querySelector(`[name="child-ChurchOfConfirmation-${i}"]`).value;
                        children.push(child);
                    }
                }
                
                const payload = { household, members, children };

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        body: JSON.stringify(payload),
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (result.result === 'success') {
                        showMessage('Form submitted successfully! Thank you.', 'bg-green-200 text-green-800');
                        censusForm.reset();
                        membersContainer.innerHTML = '';
                        childrenContainer.innerHTML = '';
                        memberCount = 0;
                        childCount = 0;
                        addMemberForm();
                        addChildForm();
                    } else {
                        showMessage(`Submission failed: ${result.error}`, 'bg-red-200 text-red-800');
                    }
                } catch (error) {
                    showMessage('An error occurred. Please try again.', 'bg-red-200 text-red-800');
                    console.error('Error submitting form:', error);
                }
            });

            function showMessage(message, colorClass) {
                messageBox.textContent = message;
                messageBox.className = `message-box ${colorClass} visible`;
            }
        });
    </script>
</body>
</html>
