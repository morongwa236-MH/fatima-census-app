<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Our Lady of Fatima Shrine Census Form</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    .form-section { border-radius: 1rem; padding: 2rem; margin-bottom: 2rem; }
    .card { background-color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 1rem; padding: 1.5rem; margin-top: 1.5rem; }
    .bg-gradient-blue { background: linear-gradient(135deg, #1d4ed8, #3b82f6); }
    .bg-gradient-green { background: linear-gradient(135deg, #059669, #10b981); }
    .bg-gradient-red { background: linear-gradient(135deg, #dc2626, #ef4444); }
    .sub-section { border-left: 4px solid #d1d5db; padding-left: 1rem; margin-left: 1rem; margin-top: 1rem; }
</style>
</head>
<body class="p-8 md:p-12">
<div class="max-w-4xl mx-auto bg-white rounded-3xl shadow-xl p-8 md:p-12">
    <header class="text-center mb-10">
        <img src="https://placehold.co/150x150/374151/FFFFFF?text=Logo" alt="Our Lady of Fatima Logo" class="mx-auto mb-4 rounded-full shadow-lg">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Our Lady of Fatima Shrine</h1>
        <p class="text-gray-600 text-lg">Household Census Form</p>
        <div id="messageBox" class="mt-4 p-4 rounded-lg text-sm text-center font-semibold hidden"></div>
    </header>
    
    <form id="censusForm" class="space-y-10">
        <!-- Household Info -->
        <div class="form-section bg-blue-50 text-gray-800">
            <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i class="fa-solid fa-house"></i> Household Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label for="blockName" class="block font-medium">Block Name</label>
                    <input type="text" id="blockName" name="blockName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="space-y-2">
                    <label for="residentialAddress" class="block font-medium">Residential Address</label>
                    <input type="text" id="residentialAddress" name="residentialAddress" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="space-y-2 col-span-1 md:col-span-2">
                    <label for="contactInformation" class="block font-medium">Contact Information</label>
                    <input type="tel" id="contactInformation" name="contactInformation" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
            </div>
        </div>

        <!-- Members Section -->
        <div class="form-section bg-green-50 text-gray-800">
            <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i class="fa-solid fa-user-group"></i> Members' Information</h2>
            <div id="membersContainer" class="space-y-6"></div>
            <button type="button" id="addMemberBtn" class="mt-6 w-full md:w-auto px-6 py-3 bg-gradient-green text-white rounded-full font-semibold shadow-lg hover:shadow-xl">
                <i class="fa-solid fa-plus mr-2"></i> Add Another Member
            </button>
        </div>

        <!-- Children Section -->
        <div class="form-section bg-red-50 text-gray-800">
            <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i class="fa-solid fa-child"></i> Children's Information</h2>
            <div id="childrenContainer" class="space-y-6"></div>
            <button type="button" id="addChildBtn" class="mt-6 w-full md:w-auto px-6 py-3 bg-gradient-red text-white rounded-full font-semibold shadow-lg hover:shadow-xl">
                <i class="fa-solid fa-plus mr-2"></i> Add Another Child
            </button>
        </div>

        <div class="flex justify-center">
            <button type="submit" class="w-full md:w-64 px-8 py-4 bg-gradient-blue text-white rounded-full font-bold text-lg shadow-xl hover:shadow-2xl">Submit Census Form</button>
        </div>
    </form>
</div>

<script>
const API_URL = 'YOUR_DEPLOYED_APPS_SCRIPT_URL_HERE';

document.addEventListener('DOMContentLoaded', () => {
    const censusForm = document.getElementById('censusForm');
    const membersContainer = document.getElementById('membersContainer');
    const childrenContainer = document.getElementById('childrenContainer');
    const addMemberBtn = document.getElementById('addMemberBtn');
    const addChildBtn = document.getElementById('addChildBtn');
    const messageBox = document.getElementById('messageBox');

    let memberCount = 0;
    let childCount = 0;

    function addMemberForm() {
        memberCount++;
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">Member #${memberCount}</h3>
                <button type="button" class="remove-btn text-gray-400 hover:text-red-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><label class="block font-medium">First Name</label><input type="text" name="member-${memberCount}-firstName" required></div>
                <div><label class="block font-medium">Last Name</label><input type="text" name="member-${memberCount}-lastName" required></div>
                <div><label class="block font-medium">Date of Birth</label><input type="date" name="member-${memberCount}-dateOfBirth" required></div>
                <div><label class="block font-medium">Catholic?</label>
                    <select name="member-${memberCount}-catholic" required>
                        <option value="">Select</option><option value="Yes">Yes</option><option value="No">No</option>
                    </select>
                </div>
                <div><label class="block font-medium">Occupation</label><input type="text" name="member-${memberCount}-occupation"></div>
                <div><label class="block font-medium">Church Activities</label><input type="text" name="member-${memberCount}-churchActivities"></div>
            </div>`;
        membersContainer.appendChild(div);
        div.querySelector('.remove-btn').addEventListener('click', ()=>div.remove());
    }

    function addChildForm() {
        childCount++;
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">Child #${childCount}</h3>
                <button type="button" class="remove-btn text-gray-400 hover:text-red-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><label class="block font-medium">First Name</label><input type="text" name="child-${childCount}-firstName" required></div>
                <div><label class="block font-medium">Last Name</label><input type="text" name="child-${childCount}-lastName" required></div>
                <div><label class="block font-medium">Date of Birth</label><input type="date" name="child-${childCount}-dateOfBirth" required></div>
                <div><label class="block font-medium">Age</label><input type="number" name="child-${childCount}-age" required></div>
                <div><label class="block font-medium">Catholic?</label>
                    <select name="child-${childCount}-catholic" required>
                        <option value="">Select</option><option value="Yes">Yes</option><option value="No">No</option>
                    </select>
                </div>
                <div><label class="block font-medium">Church Activities</label><input type="text" name="child-${childCount}-churchActivities"></div>
            </div>`;
        childrenContainer.appendChild(div);
        div.querySelector('.remove-btn').addEventListener('click', ()=>div.remove());
    }

    addMemberForm(); // default one
    addChildForm();  // default one

    addMemberBtn.addEventListener('click', addMemberForm);
    addChildBtn.addEventListener('click', addChildForm);

    censusForm.addEventListener('submit', async e=>{
        e.preventDefault();
        showMessage('Submitting...', 'bg-blue-200 text-blue-800');

        const formData = new FormData(censusForm);
        const household = {
            blockName: formData.get('blockName'),
            residentialAddress: formData.get('residentialAddress'),
            contactInformation: formData.get('contactInformation')
        };

        const members = [];
        for(let i=1;i<=memberCount;i++){
            if(formData.get(`member-${i}-firstName`)) {
                members.push({
                    firstName: formData.get(`member-${i}-firstName`),
                    lastName: formData.get(`member-${i}-lastName`),
                    dateOfBirth: formData.get(`member-${i}-dateOfBirth`),
                    catholic: formData.get(`member-${i}-catholic`),
                    occupation: formData.get(`member-${i}-occupation`) || '',
                    churchActivities: formData.get(`member-${i}-churchActivities`) || ''
                });
            }
        }

        const children = [];
        for(let i=1;i<=childCount;i++){
            if(formData.get(`child-${i}-firstName`)) {
                children.push({
                    firstName: formData.get(`child-${i}-firstName`),
                    lastName: formData.get(`child-${i}-lastName`),
                    dateOfBirth: formData.get(`child-${i}-dateOfBirth`),
                    age: formData.get(`child-${i}-age`),
                    catholic: formData.get(`child-${i}-catholic`),
                    churchActivities: formData.get(`child-${i}-churchActivities`) || ''
                });
            }
        }

        try {
            await fetch(API_URL, {
                method:'POST',
                body: JSON.stringify({action:'create', household, members, children}),
                headers:{'Content-Type':'application/json'}
            });
