    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Admin Dashboard</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <style>
            body {
                font-family: 'Inter', sans-serif;
                background-color: #f3f4f6;
            }
            .admin-card {
                background-color: white;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                border-radius: 1rem;
                padding: 1.5rem;
            }
            .loading {
                border: 4px solid rgba(0, 0, 0, 0.1);
                border-left-color: #1d4ed8;
                border-radius: 50%;
                width: 24px;
                height: 24px;
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            .text-sm-condensed {
                font-size: 0.8rem;
                line-height: 1.2;
            }
        </style>
    </head>
    <body class="p-8 md:p-12">
        <div class="max-w-6xl mx-auto space-y-8">
            <header class="text-center">
                <h1 class="text-3xl font-bold text-gray-800">Admin Dashboard</h1>
                <p class="text-gray-600">Manage census records for Our Lady of Fatima Shrine</p>
            </header>

            <!-- Search and Filter Section -->
            <div class="admin-card">
                <h2 class="text-xl font-bold mb-4">Search Records</h2>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="searchInput" placeholder="Search by name, address, or block" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-300">
                    <button id="searchBtn" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-300">Search</button>
                    <button id="viewAllBtn" class="px-6 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-300">View All</button>
                </div>
            </div>
            
            <!-- Counts Section -->
            <div class="admin-card grid grid-cols-1 md:grid-cols-3 gap-6">
                <h2 class="text-xl font-bold col-span-full">Quick Counts</h2>
                <div class="bg-indigo-100 p-4 rounded-lg flex flex-col justify-center items-center">
                    <p class="text-indigo-800 font-semibold">Total Households</p>
                    <span id="householdCount" class="text-3xl font-bold text-indigo-900">...</span>
                </div>
                <div class="bg-indigo-100 p-4 rounded-lg flex flex-col justify-center items-center">
                    <p class="text-indigo-800 font-semibold">Total Members</p>
                    <span id="memberCount" class="text-3xl font-bold text-indigo-900">...</span>
                </div>
                <div class="bg-indigo-100 p-4 rounded-lg flex flex-col justify-center items-center">
                    <p class="text-indigo-800 font-semibold">Total Children</p>
                    <span id="childCount" class="text-3xl font-bold text-indigo-900">...</span>
                </div>
            </div>

            <!-- Results Section -->
            <div class="admin-card">
                <h2 class="text-xl font-bold mb-4">Census Records</h2>
                <div id="resultsContainer">
                    <div id="loadingIndicator" class="hidden flex justify-center py-8">
                        <div class="loading"></div>
                    </div>
                    <div id="recordsList" class="space-y-6">
                        <!-- Records will be displayed here -->
                    </div>
                    <div id="noResults" class="hidden text-center text-gray-500 py-8">
                        <p>No records found. Try a different search.</p>
                    </div>
                </div>
            </div>

            <!-- Modal for details/editing (hidden by default) -->
            <div id="recordModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4">
                <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">Record Details</h3>
                        <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    <div id="modalContent">
                        <!-- Content will be loaded here -->
                    </div>
                    <button id="printBtn" class="mt-6 w-full px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition duration-300">
                        <i class="fa-solid fa-print mr-2"></i> Print Record
                    </button>
                    <button id="deleteBtn" class="mt-4 w-full px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition duration-300">
                        <i class="fa-solid fa-trash-can mr-2"></i> Delete Record
                    </button>
                </div>
            </div>
        </div>

        <script>
            // PASTE YOUR DEPLOYED GOOGLE APPS SCRIPT WEB APP URL HERE
            const API_URL = 'hhttps://script.google.com/macros/s/AKfycbzRc66nKusTgL-QJgjJfIuZ3OEq5f8Wtr9D-1gFCqDL3XBNiQGtiM6xV5kasw9t2qX1/exec'; 
            
            document.addEventListener('DOMContentLoaded', () => {
                const searchInput = document.getElementById('searchInput');
                const searchBtn = document.getElementById('searchBtn');
                const viewAllBtn = document.getElementById('viewAllBtn');
                const loadingIndicator = document.getElementById('loadingIndicator');
                const recordsList = document.getElementById('recordsList');
                const noResults = document.getElementById('noResults');
                const recordModal = document.getElementById('recordModal');
                const closeModalBtn = document.getElementById('closeModalBtn');
                const modalContent = document.getElementById('modalContent');
                const householdCountEl = document.getElementById('householdCount');
                const memberCountEl = document.getElementById('memberCount');
                const childCountEl = document.getElementById('childCount');

                // Initial load of all records and counts
                fetchData();
                fetchCounts();

                searchBtn.addEventListener('click', () => {
                    const query = searchInput.value;
                    if (query) {
                        fetchData(query);
                    }
                });

                viewAllBtn.addEventListener('click', () => {
                    searchInput.value = '';
                    fetchData();
                });

                closeModalBtn.addEventListener('click', () => {
                    recordModal.classList.add('hidden');
                });
                
                async function fetchCounts() {
                    try {
                        const response = await fetch(`${API_URL}?action=getCounts`);
                        const result = await response.json();
                        if (result.counts) {
                            householdCountEl.textContent = result.counts.totalHouseholds;
                            memberCountEl.textContent = result.counts.totalMembers;
                            childCountEl.textContent = result.counts.totalChildren;
                        }
                    } catch (error) {
                        console.error('Error fetching counts:', error);
                        // Fallback to '...' in case of error
                        householdCountEl.textContent = '...';
                        memberCountEl.textContent = '...';
                        childCountEl.textContent = '...';
                    }
                }

                async function fetchData(query = '') {
                    loadingIndicator.classList.remove('hidden');
                    recordsList.innerHTML = '';
                    noResults.classList.add('hidden');

                    try {
                        const url = query ? `${API_URL}?q=${encodeURIComponent(query)}` : API_URL;
                        const response = await fetch(url);
                        const data = await response.json();
                        
                        if (data && data.length > 0) {
                            renderRecords(data);
                            noResults.classList.add('hidden');
                        } else {
                            noResults.classList.remove('hidden');
                        }
                    } catch (error) {
                        console.error('Error fetching data:', error);
                        noResults.classList.remove('hidden');
                    } finally {
                        loadingIndicator.classList.add('hidden');
                    }
                }

                function renderRecords(records) {
                    records.forEach(record => {
                        const household = record.household;
                        const members = record.members;
                        const children = record.children;

                        const recordDiv = document.createElement('div');
                        recordDiv.className = 'admin-card hover:bg-gray-50 transition duration-300 cursor-pointer';
                        recordDiv.innerHTML = `
                            <h3 class="text-lg font-bold text-blue-600">${household.BlockName} - ${household.ResidentialAddress}</h3>
                            <p class="text-sm-condensed text-gray-500">Household ID: ${household.HouseholdID}</p>
                            <p class="text-gray-700 mt-2 font-semibold">Members: <span class="font-normal">${members.length}</span></p>
                            <p class="text-gray-700 font-semibold">Children: <span class="font-normal">${children.length}</span></p>
                        `;
                        recordDiv.addEventListener('click', () => showRecordDetails(record));
                        recordsList.appendChild(recordDiv);
                    });
                }
                
                function showRecordDetails(record) {
                    const household = record.household;
                    const members = record.members;
                    const children = record.children;

                    let content = `
                        <h4 class="text-lg font-bold text-gray-800 mb-2">Household Information</h4>
                        <ul class="list-disc list-inside space-y-1 mb-6">
                            <li><strong>Block Name:</strong> ${household.BlockName}</li>
                            <li><strong>Residential Address:</strong> ${household.ResidentialAddress}</li>
                            <li><strong>Contact:</strong> ${household.ContactInformation}</li>
                        </ul>
                    `;

                    if (members.length > 0) {
                        content += `
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Members</h4>
                            <div class="space-y-4 mb-6">
                        `;
                        members.forEach(member => {
                            content += `
                                <div class="p-4 bg-gray-100 rounded-lg">
                                    <p class="font-semibold">${member.FirstName} ${member.LastName}</p>
                                    <ul class="list-disc list-inside text-sm-condensed space-y-1 mt-2">
                                        <li><strong>Date of Birth:</strong> ${member.DateOfBirth}</li>
                                        <li><strong>Catholic?:</strong> ${member.Catholic}</li>
                                        <li><strong>Occupation:</strong> ${member.Occupation}</li>
                                        <li><strong>Marital Status:</strong> ${member.MaritalStatus}</li>
                                        <li><strong>Dikabelo?:</strong> ${member.Dikabelo}</li>
                                        <!-- Add more details as needed -->
                                    </ul>
                                </div>
                            `;
                        });
                        content += `</div>`;
                    }
                    
                    if (children.length > 0) {
                        content += `
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Children</h4>
                            <div class="space-y-4">
                        `;
                        children.forEach(child => {
                            content += `
                                <div class="p-4 bg-gray-100 rounded-lg">
                                    <p class="font-semibold">${child.FirstName} ${child.LastName}</p>
                                    <ul class="list-disc list-inside text-sm-condensed space-y-1 mt-2">
                                        <li><strong>Date of Birth:</strong> ${child.DateOfBirth}</li>
                                        <li><strong>Age:</strong> ${child.Age}</li>
                                        <li><strong>Catholic?:</strong> ${child.Catholic}</li>
                                        <!-- Add more details as needed -->
                                    </ul>
                                </div>
                            `;
                        });
                        content += `</div>`;
                    }
                    
                    modalContent.innerHTML = content;
                    recordModal.classList.remove('hidden');
                }
                
                // Print functionality (basic)
                document.getElementById('printBtn').addEventListener('click', () => {
                    const printContent = document.getElementById('modalContent').innerHTML;
                    const originalContent = document.body.innerHTML;
                    document.body.innerHTML = printContent;
                    window.print();
                    document.body.innerHTML = originalContent;
                    window.location.reload(); // Reload to restore functionality
                });
                
                // Delete functionality (placeholder, requires API extension)
                document.getElementById('deleteBtn').addEventListener('click', () => {
                    if (window.confirm("Are you sure you want to delete this record? This action cannot be undone.")) {
                        // TODO: Implement API call to delete record by HouseholdID
                        alert("Delete functionality not yet implemented in the API. Manual deletion in Google Sheet is required.");
                    }
                });
            });
        </script>
    </body>
    </html>
    
